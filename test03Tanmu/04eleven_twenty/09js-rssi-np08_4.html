<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>rssi08_4</title>
</head>
<body>

	<script>
		
		window.onload = function(){

			// db:hotmap   table:locOrg
			let rssi = 0;
			let np = 0;
			let mac = "4cfacaf650a0";
			
			//rssiMin && rssiMax && npMax && t
			const rssiMin = -110;
			const rssiMax = -50;
			const npMax = 90;
			const t = 1515028396607; //seconds


			//macRandom---mac设备id
			function macRandom(){

				const letterArr = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n",
				"o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"]
				const numArr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
				let str = ""

				for(let i = 0; i < 6; i++){
					const n = Math.round(Math.random() * 25)
					const m = Math.round(Math.random() * 9)
					str += letterArr[n].concat(numArr[m])
					//console.log(n, m)
				}
				return str
			}

			//rssiRandom---rssi值的范围
			function rssiRandom(){
				let rssiRan = Math.round(Math.random() * 60) + (-110)
				return rssiRan
			}

			//locationObj -- npArr
			// console.log("locationObj", locationObj)
			//addNp--循环模拟设备数量
			function addNp(newArr){
				
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: "0.0.0.0",
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}
			
			//addNp2 && addNp3
			function addNp2(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}

			function addNp3(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}


			function addNp4(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}


			function addNp5(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}


			function addNp6(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}


			function addNp7(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}


			function addNp8(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}


			function addNp9(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			}

			function addNp10(newArr){
				for(let i = 0; i<300; i++){
					let newNp = {
						mac: macRandom(),
						ip: '0.0.0.0',
						channel: 153,
						radioType: 1,
						connected: 0,
						rssi: rssiRandom(),
						noiseFloor: -105
					}
					newArr.push(newNp)
				}
				return newArr
			} 

			let npArr = [
				
			]

			let locationObj = {
				id: "4cfacaf650a0@1515028396607",
				mac: "4cfacaf650a0",
				t: 1515028396607,
				np: npArr.length,
				devices: addNp(npArr)
			}

			//npArr2 && npArr3
			let npArr2 = [], npArr3 = [], npArr4 = [], npArr5 = [], npArr6 = [],
				npArr7 = [], npArr8 = [], npArr9 = [], npArr10 = [];

			let locationObj2 = {
				id: '4cfacaf650a0@1515028396607_S2',
				mac: "4cfacaf650a0_S2",
				t: 1515028396607,
				np: npArr2.length,
				devices: addNp2(npArr2)
			}

			let locationObj3  = {
				id: '4cfacaf650a0@1515028396607_S3',
				mac: "4cfacaf650a0_S3",
				t: 1515028396607,
				np: npArr.length,
				devices: addNp3(npArr3)
			}

			let locationObj4 = {
				id: '4cfacaf650a0@1515028396607_S4',
				mac: "4cfacaf650a0_S4",
				t: 1515028396607,
				np: npArr4.length,
				devices: addNp4(npArr4)
			}

			let locationObj5 = {
				id: '4cfacaf650a0@1515028396607_S5',
				mac: "4cfacaf650a0_S5",
				t: 1515028396607,
				np: npArr5.length,
				devices: addNp5(npArr5)
			}

			let locationObj6 = {
				id: '4cfacaf650a0@1515028396607_S6',
				mac: "4cfacaf650a0_S6",
				t: 1515028396607,
				np: npArr6.length,
				devices: addNp6(npArr6)
			}

			let locationObj7 = {
				id: '4cfacaf650a0@1515028396607_S7',
				mac: "4cfacaf650a0_S7",
				t: 1515028396607,
				np: npArr7.length,
				devices: addNp7(npArr7)
			}

			let locationObj8 = {
				id: '4cfacaf650a0@1515028396607_S8',
				mac: "4cfacaf650a0_S8",
				t: 1515028396607,
				np: npArr8.length,
				devices: addNp8(npArr8)
			}

			let locationObj9 = {
				id: '4cfacaf650a0@1515028396607_S9',
				mac: "4cfacaf650a0_S9",
				t: 1515028396607,
				np: npArr9.length,
				devices: addNp9(npArr9)
			}

			let locationObj10 = {
				id: '4cfacaf650a0@1515028396607_S10',
				mac: "4cfacaf650a0_S10",
				t: 1515028396607,
				np: npArr10.length,
				devices: addNp10(npArr10)
			}

			//locationObjArr
			let locationObjArr = []
			if(locationObjArr.length === 0){
				locationObjArr.push(locationObj)
				locationObjArr.push(locationObj2)
				locationObjArr.push(locationObj3)
				locationObjArr.push(locationObj4)
				locationObjArr.push(locationObj5)
				locationObjArr.push(locationObj6)
				locationObjArr.push(locationObj7)
				locationObjArr.push(locationObj8)
				locationObjArr.push(locationObj9)
				locationObjArr.push(locationObj10)
			}

			let npArrAll = []
			if(npArrAll.length === 0){
				npArrAll.push(npArr)
				npArrAll.push(npArr2)
				npArrAll.push(npArr3)
				npArrAll.push(npArr4)
				npArrAll.push(npArr5)
				npArrAll.push(npArr6)
				npArrAll.push(npArr7)
				npArrAll.push(npArr8)
				npArrAll.push(npArr9)
				npArrAll.push(npArr10)
			}

			//console.log(npArr)
			//senNp---模拟3s报告一次数量,发满90个,多余的下一次发送
			let count = 0;
			function sendNp(){
				

				for(let i = 0; i<npArrAll.length; i++){
					let sendArr = []
					
					if(npArrAll[i].length >= 90){
						sendArr = npArrAll[i].splice(0, 90)
						console.log(sendArr, i, new Date().getSeconds())
						if(npArrAll[i].length < 90 && npArrAll[i].length > 0){
							setTimeout(function(){
								sendArr = npArrAll[i].splice(0, npArrAll[i].length)
								console.log(sendArr, i, new Date().getSeconds())
							}, 3000)
						}
					} 

					if(npArrAll[i].length === 0){
						window.clearInterval(inter)
						inter = 0;
						npArrAll = []
						console.log(npArrAll, new Date().getSeconds())
					}

				} 

				return sendNp
			}

			//循环发送
			function sendCircu(){
				if(inter === 0){

					npArrAll.push(addNp(npArr))
					npArrAll.push(addNp(npArr2))
					npArrAll.push(addNp(npArr3))
					npArrAll.push(addNp(npArr4))
					npArrAll.push(addNp(npArr5))
					npArrAll.push(addNp(npArr6))
					npArrAll.push(addNp(npArr7))
					npArrAll.push(addNp(npArr8))
					npArrAll.push(addNp(npArr9))
					npArrAll.push(addNp(npArr10))
					
					//console.log(npArr)
					inter = setInterval(sendNp(), 3000)
					//console.log('time', new Date().getSeconds())
				}else if(inter > 0){
					//console.log("hhhhhhh", inter)
					//console.log(npArrAll)
					//console.log('time', new Date().getSeconds())
				}
				return sendCircu
			}

			let inter = 0, inter2 = 0;
		
			//第一次不延时
			inter = setInterval(sendNp(), 3000)
			
			//循环发送
			inter2 = setInterval(sendCircu(), 10000)

		}
		
	</script>
</body>
</html>