<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ejs index</title>

    <style>

       
    </style>
    <link rel="stylesheet" href="css/basic.css">
</head>
<body>
    <div class="container">
        <!-- <h2>ejs index</h2>
        <div class="nav">
            <ul class="nav-list">
                <% for(let i = 0; i< 5; i++) {%>
                    <li><%= i %></li>
                <% } %>
            </ul>
        </div> -->

        <div class="login-con">
            <h3>登录</h3>
            <hr>
            <div class="login-box">
                <form action="<%= host %>/show" method="post" enctype="multipart/form-data">
                    <ul class="login-list">
                        <li>
                            <label for="user">用户名</label>
                            <input type="text" id="user" class="user-input" placeholder="username" name="name">
                        </li>
                        <li>
                                <label for="file">上传头像:</label>
                                <input type="file" name="image" id="file" onchange="showPreview(this)" />
                                <div class="preview">
                                    
                                </div>
                        </li>
                        <li>
                            <label for="login-btn">登&nbsp;&nbsp;&nbsp;录</label>
                            <input type="submit" value="登录" class="sub" >
                        </li>
                    </ul>
                </form>
                
            </div>
        </div>

        <!-- <div class="chat-box">
            <div class="title-con">
                
            </div>
            <div class="chat-con-init">
                <!-- <div class="chat-con">
                    <div class="inner-msg-all">
                        <div class="inner-msg-r">
                            this is myself 
                        </div>
                        <div class="inner-name-r">
                            zhangsan
                        </div>
                        <div class="header-img-r">
                            <img src="/images/add.png" alt="header" width="20" height="20">
                        </div>
                    </div>
                </div> -->
                
                

                <!-- <div class="chat-con-ano">
                    <div class="inner-msg-ano">

                        <div class="header-img-l">
                            <img src="/images/add.png" alt="header" width="20" height="20">
                        </div>
                        <div class="inner-name-l">
                            lisi
                        </div>
                        <div class="inner-msg-l">
                            this issfsdfsdf
                        </div>
                    </div>
                </div> -->
            <!-- </div>

            <div class="chat-insert">
                <input type="text" placeholder="say something" class="input-msg">
                <input type="submit" value="send" class="send-msg">
            </div>
        </div> --> -->

    </div>

    <script src="/js/index.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        
        // const url = 'http://localhost:8002'
        // let socket = io.connect(url) 

        // const loginCon = document.querySelector('.login-con')
        // const userInput = document.querySelector('.user-input')
        // const sub = document.querySelector('.sub')

        // //chat-box
        // const chatBox = document.querySelector('.chat-box')
        // const titleCon = document.querySelector('.title-con')
        // const chatInsert = document.querySelector('.chat-insert')
        
        // //username
        // let _username = null

        // //setUsername
        // let setUsername = function () {
        //     _username = userInput.value.trim() //trim() 去除首尾空格
        //     console.log(_username)
        //     //if  socket.emit向服务端发送login事件，
        //     if(_username) {
        //         socket.emit('login', {
        //             username: _username
        //         })
        //         console.log(_username)
        //         return;
        //     }
        // }

        // //前端事件
        // sub.onclick = function() {
        //     setUsername()
        // }
        // onkeyup
        // userInput.onkeyup = function(evt){
        //     let e = evt || window.event
        //     if(e.keyCode === 13) {
        //         setUsername()
        //     }
        // }

        // //显示聊天界面
        // let beginChat = function () {
        //     loginCon.style.display = 'none'
        //     sub.onclick = null
        //     userInput.onkeyup = null
            
        //     let p = document.createElement('p')
        //     p.style.background = 'lightcyan'
        //     let userTxt = document.createTextNode(`Welcome you : ${_username}`)
        //     p.appendChild(userTxt)
        //     //显示页面， welcome
        //     let str = `<p>欢迎你${_username}</p>`
        //     titleCon.appendChild(p)

        //     chatBox.style.display = 'block'
        // }
        
        // //loginSuccess
        // socket.on('loginSuccess', function(data) {
        //     if(data.username === _username) {
        //         beginChat()
        //     }else {
        //         alert('failed')
        //     }
        // })
        
        // //聊天一定是客户端触发的，所以发送信息是客户端触发，服务器监听。
        // //sendmessage
        // const inputMsg = document.querySelector('.input-msg')
        // let sendMessage = function () {
        //     let _message = inputMsg.value
        //     if(_message) {
        //         socket.emit('sendMessage', {
        //             username: _username,
        //             message: _message
        //         })
        //     }
        // }

        // //sendMsg 触发
        // const sendMsg = document.querySelector('.send-msg')
        // console.log(sendMsg.value)
        // sendMsg.onclick = function() {
        //     sendMessage()
        //     inputMsg.value = ''
        //     console.log()
        // }
        // inputMsg.onkeydown = function(evt) {
        //     let e = evt || event
        //     if(e.keyCode == '13'){
        //         console.log("ddddddddd")
        //         sendMessage()
        //         inputMsg.value = ''
        //     }

        // }

        
        
        // //chat-con-init
        // const chatConInit = document.querySelector('.chat-con-init')

        
        // //recieveMessage
        // socket.on('receiveMessage', function(data) {
        //     showMessage(data)
        // })
        // let arrMsg = []
        // //showMessage
        // let showMessage = function (data) {

        //     //判断这个消息是不是自己发出的，
        //     if(data.username === _username) {
        //         // let str = `<p style='background: lightskyblue'><span>${data.username} : </span> ${data.message}</p>`
        //         // chatCon.style.width = '100%'
        //         // chatCon.style.margin =  10 + 'px' 
        //         let str = `<div class="inner-msg-all">
        //             <div class="inner-msg-r">
        //                 ${data.message}
        //             </div>
        //             <div class="inner-name-r">
        //                 ${data.username}
        //             </div>
        //             <div class="header-img-r">
        //                 <img src="/images/add.png" alt="header" width="20" height="20">
        //             </div>
        //         </div> `
                
        //         const chatCon = document.createElement('div')
        //         chatCon.className = 'chat-con'

        //         let div1 = document.createElement('div')
        //         div1.className = 'inner-msg-all'
        //         let div2 = document.createElement('div')
        //         div2.className = 'inner-msg-r'
        //         div2.innerText = data.message

        //         let div3 = document.createElement('div')
        //         div3.className = 'inner-name-r'
        //         div3.innerText = data.username
        //         let div4 = document.createElement('div')
        //         div4.className = 'header-img-r'

        //         let img = document.createElement('img')
        //         img.src = '/images/add.png'
        //         img.width = '20'
        //         img.height = '20'
                
        //         div4.appendChild(img)
        //         div1.appendChild(div2)
        //         div1.appendChild(div3)
        //         div1.appendChild(div4)
        //         chatCon.appendChild(div1)

        //         chatConInit.appendChild(chatCon)

        //     }else {
        //         // let str = `<p style='background: lightpink'><span>${data.username} : </span> ${data.message}</p>`
        //         let str =  `<div class="inner-msg-ano">
        //                         <div class="header-img-l">
        //                             <img src="/images/avator.png" alt="header" width="20" height="20">
        //                         </div>
        //                         <div class="inner-name-l">
        //                             ${data.username}
        //                         </div>
        //                         <div class="inner-msg-l">
        //                             ${data.message}
        //                         </div>
        //                     </div>`
                            
        //         const chatConAno = document.createElement('div')
        //         chatConAno.className = 'chat-con-ano'

        //         let div1 = document.createElement('div')
        //         div1.className = 'inner-msg-ano'
        //         let div2 = document.createElement('div')
        //         div2.className = 'header-img-l'
        //         let div3 = document.createElement('div')
        //         div3.className = 'inner-name-l'
        //         div3.innerText = data.username
        //         let div4 = document.createElement('div')
        //         div4.className = 'inner-msg-l'
        //         div4.innerText = data.message

        //         let img = document.createElement('img')
        //         img.src = '/images/avator.png'
        //         img.width = '20'
        //         img.height = '20'

        //         div2.appendChild(img)
        //         div1.appendChild(div2)
        //         div1.appendChild(div3)
        //         div1.appendChild(div4)
        //         chatConAno.appendChild(div1)

        //         chatConInit.appendChild(chatConAno)

        //     }
        // }

        //preview
        const preview = document.querySelector('.preview')
		const preview2 = document.querySelector('.preview2')

		function showPreview(source) {  
	        let file = source.files[0];  
	        if (window.FileReader) {  
	            let fr = new FileReader();  
	            fr.onloadend = function(e) {  
	            	let str = `<img src="${e.target.result}" alt="">`
	                preview.innerHTML = str 
	            };  

	            if (file){
	            	fr.readAsDataURL(file)
	            } else{
	            	preview.innerHTML = ''
	            }
	            // fr.readAsDataURL(file);  
	        }  
	        
		} 
        
    </script>
</body>
</html>